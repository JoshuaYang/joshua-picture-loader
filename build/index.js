!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PictureLoader=e():t.PictureLoader=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){r(this,t);for(var n in e)this[n]=e[n]}return o(t,[{key:"load",value:function(){var t=this,e=this.getSource();return new Promise(function(n,r){var o=new Image;o.crossOrigin="anonymous",o.onload=n,o.onerror=r,o.src=e,t.image=o})}},{key:"getSource",value:function(){var t=JSON.parse(sessionStorage.getItem(this.src))||{},e=t.expiration;return this.needStore=void 0===e||e<Date.now(),this.needStore?this.src:t.source}},{key:"save",value:function(t){if(this.needStore){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=this.image.width,e.height=this.image.height,n.drawImage(this.image,0,0);var r={expiration:Date.now()+t,source:e.toDataURL("image/png")};try{sessionStorage.setItem(this.src,JSON.stringify(r))}catch(t){}}}},{key:"setContent",value:function(){void 0!==this.container&&(this.useBg?this.container.style.backgroundImage="url("+this.src+")":this.container.appendChild(this.image),this.container.classList.add("loaded"))}}]),t}();e.default=i,t.exports=e.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(0),s=r(u);Promise.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})};var l=window.navigator.userAgent.toLowerCase(),c=null!==l.match(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile/i)&&null!==l.match(/Mobile/i),f=null!==l.match(/ipad/i),h=null!==l.match(/android/i),d=h&&!c,v=f||d,g=/(msie|trident)/i.test(navigator.userAgent),p=!(c||v),y=function(){function t(e){i(this,t),this.className="preload",this.loadOne=function(){},this.loadAll=function(){},this.loadCount=0,this.pictureList=[];for(var n in e)this[n]=e[n];if(void 0===this.sourceQueue)for(var r=[].concat(o(document.getElementsByClassName(this.className))),a=0;a<r.length;a++){var u=r[a],l=u.getAttribute(t.dataName),c=null!==u.getAttribute(t.flagBg),f=new s.default({src:l,container:u,useBg:c});this.pictureList.push(f)}else{var h=!0,d=!1,v=void 0;try{for(var g,p=this.sourceQueue[Symbol.iterator]();!(h=(g=p.next()).done);h=!0){var y=g.value,m=new s.default({src:y});this.pictureList.push(m)}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}}this.totalCount=this.pictureList.length}return a(t,[{key:"load",value:function(){var e=this;if(0===this.totalCount)return void this.loadAll(this.totalCount);var n=!0,r=!1,o=void 0;try{for(var i,a=function(){var n=i.value;n.load().then(function(){t.useStorage&&n.save(t.survivalTime),n.setContent()},function(){}).finally(function(){e.loadHandler()})},u=this.pictureList[Symbol.iterator]();!(n=(i=u.next()).done);n=!0)a()}catch(t){r=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(r)throw o}}}},{key:"loadHandler",value:function(){this.loadCount+=1,this.loadOne(this.loadCount,this.totalCount),this.loadCount===this.totalCount&&this.loadAll(this.totalCount)}}]),t}();y.dataName="data-source",y.flagBg="data-bg",y.survivalTime=6e4,y.useStorage=p&&!g,e.default=y,t.exports=e.default}])});